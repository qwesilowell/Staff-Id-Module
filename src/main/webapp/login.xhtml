<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <f:facet name="first">
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
            <meta name="apple-mobile-web-app-capable" content="yes" />
        </f:facet>

        <h:outputStylesheet library="css" name="style.css"/>
        <h:outputStylesheet library="css" name="cropper.min.css"/>

        <title>Staff Id Module-Login Page</title>
        <h:outputScript library="js" name="menuscript.js" target="body" />
        <h:outputScript library="js" name="webcam.js"/>
        <h:outputScript library="js" name="cropper.min.js"/>
        <h:outputScript library="js" name="facial.js"/>
        <h:outputScript library="js" name="orbis.js" target="head"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    </h:head>
    <h:body>
        <!-- Navigation Bar -->
        <h:form>
        <div class="navbar">
           
            <h2 class="nav-title">STAFF ID MODULE</h2>
            <p:commandLink value="Login with Email/Password?" 
                           style="color: white;white-space: nowrap;"
                           action="#{loginBean.loginWithEmail()}" />
        </div>
        </h:form>

<!--        <h:outputText value="#{flash.successMessage}" rendered="#{not empty flash.successMessage}" style="color: green; font-weight: bold; display: block; margin: 10px 0;" />-->

        <div class="background"></div>
        <div class="login-container">
            <h:form id="theForm" prependId="false" >
                <div class="cont">
                    <!-- Sign In Form -->
                    <div class="form sign-in" style="overflow: auto;">
                        <p:growl widgetVar="fgrowl" id="growl" showSummary= "false" showDetail="true" life="6000" globalOnly="false"/>
                        <h2>Sign In</h2>

                        <p:tabView dynamic="true" cache="true" prependId="false" >

                            <p:tab title="Single finger login">

                                <p class="m-0">

                                    <h:panelGroup>
                                        <div style="margin-bottom: 10px; text-align: center">
                                            <h:outputLabel for="username" value="Enter National ID: *" />
                                            <p:inputText id="ghanaCardPin" value="#{loginBean.ghanaCardNumber}"  placeholder="GHA-XXXXXXXXX-X"/>
                                        </div>

                                        <br/>
                                        <div class="card" >
                                            <div style="display: flex; flex-direction: column; gap: 20px;">
                                                <div style="display: flex; flex-direction: row; gap: 0px; justify-content: center; align-content: center">
                                                    
                                                    <p:selectOneMenu id="position" value="#{loginBean.fingerPosition}" widgetVar="position">
                                                        <f:selectItem itemLabel="SELECT FINGER" itemValue="" noSelectionOption="true"/>
                                                        <f:selectItem itemLabel="Left Thumb" itemValue="LT"/>
                                                        <f:selectItem itemLabel="Left Index" itemValue="LI"/>
                                                        <f:selectItem itemLabel="Left Middle" itemValue="LM"/>
                                                        <f:selectItem itemLabel="Left Ring" itemValue="LR"/>
                                                        <f:selectItem itemLabel="Left Little" itemValue="LL"/>
                                                        <f:selectItem itemLabel="Right Thumb" itemValue="RT"/>
                                                        <f:selectItem itemLabel="Right Index" itemValue="RI"/>
                                                        <f:selectItem itemLabel="Right Middle" itemValue="RM"/>
                                                        <f:selectItem itemLabel="Right Ring" itemValue="RR"/>
                                                        <f:selectItem itemLabel="Right Little" itemValue="RL"/>
                                                    </p:selectOneMenu>
                                                </div>
                                                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                                                    <h:graphicImage id="fingerImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/> 
                                                    <h:inputHidden id="fingerData" value="#{loginBean.capturedFinger}"/>
                                                    <h3>Finger Print Image</h3>
                                                </div>
                                                <div class="card">
                                                    <div style="display: flex; flex-direction: row; gap: 5px; align-content: center; justify-content: center">
                                                        <p:commandButton value="Capture" style="padding: 5px 10px; font-size: 10px; height: 40px;" styleClass=" ui-button-secondary ui-button-raised" onclick="doSend('action:start:single');" type="button" icon="fa fa-thin fa-fingerprint fa-shake"/>
                                                        <p:commandButton value="Reset" style="padding: 5px 6px; font-size: 10px; height: 40px;" styleClass=" ui-button-warning ui-button-danger" onclick="doSendNoId('action:stop')" action="#{loginBean.reset}" update="@form" icon="pi pi-refresh"/>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <br/><br/>
                                        <div class="auth-card" style=" display: flex; align-content: center; justify-content: center">
                                            <p:commandButton value="Login" action="#{loginBean.submit()}" styleClass="verify-button"  update="growl passwordChangeForm"/>
                                            <h:inputText id="socketData" style="display: none;" value="#{loginBean.socketData}" disabled="true"/>
                                            <h:inputHidden id="socketDataHidden"/>
                                        </div>
                                    </h:panelGroup>

                                </p>

                            </p:tab>


                            <p:tab title="Face Login">
                                <p class="m-0">
                                    <h:panelGroup>
                                        <h:inputHidden id="faceImage" value="#{loginBean.faceImageData}" />
                                        <div class="face-content-container">
                                            <h3 class="verification-heading">Facial Verification</h3>

                                            <div class="input-group">
                                                <p:outputLabel for="faceNationalId" value="Enter National ID:" styleClass="input-label" style=""/>
                                                <p:inputText id="faceNationalId" value="#{loginBean.ghanaCardNumber}" 
                                                             placeholder="GHA-XXXXXXXX-X" 
                                                             styleClass="id-input"/>
                                            </div>

                                            <div class="capture-container">
                                                <p:outputLabel value="Face Capture: *" styleClass="capture-label"/>
                                                <div id="faceImageContainer" class="face-capture-area"></div>
                                            </div>

                                            <div class="button-container">
                                                <div class="capture-buttons">
                                                    <p:commandButton id="cameraButton" value="Open Camera"  type="button" icon="pi pi-camera" iconPos="left"
                                                                     styleClass="capture-button" onclick="toggleCamera()" />
                                                    
                                                    <p:commandButton id="captureButton" value="Capture Face" onclick="capture();" type="button" 
                                                                     styleClass="capture-face"/>
                                                </div>
                                                <p:commandButton value="LOGIN" onclick="saveCroppedImage()" 
                                                                 action="#{loginBean.verifyFace()}" update="growl passwordChangeForm" 
                                                                 styleClass="verify-button"/>
                                            </div>
                                        </div>
                                    </h:panelGroup>
                                </p>
                            </p:tab>   
                        </p:tabView>
                    </div>

                    <!-- Multi Finger Section -->
                    <div class="sub-cont">
                        <div class="img">
                            <div class="img-text m-up">
                                <h2>No National ID?</h2>
                                <p>Use all fingers</p>
                            </div>
                            <div class="img-text m-in">
                                <h2>Use National ID ?</h2>
                                <p></p>
                            </div>
                            <div class="img-btn">
                                <span class="m-up">Switch</span>
                                <span class="m-in">Click Here</span>
                            </div>
                        </div>

                        <!-- Sign Up Form -->
                        <div class="form sign-up" style="overflow: auto;">
                            <h2>Use Multi Finger</h2>
                            <div style="display: flex; flex-direction: row; gap:20px; ">
                                <p:commandButton value="Reset" styleClass=" ui-button-warning ui-button-danger" onclick="doSendNoId('action:stop')" action="#{loginBean.reset()}" update="@form" style="padding:1px; font-weight: bold"/>
                            </div>

                            <br/>

                            <div style="display: flex; flex-direction: column; width: 100%; justify-content: center; align-content: center;">

                                <div class="card">
                                    <div style="display: flex; flex-direction: row; gap: 10px; justify-content: center; align-content: center; ">
                                        <div class="col-3 col-md-3 col-lg-3">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="leftIndexImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/> 
                                            </div>
                                            <h:inputHidden id="leftIndex" value="#{loginBean.capturedMultiFinger.leftIndex}"/>
                                            <h6 style="text-align:center; font-size: medium; font-weight: bold;" >Left Index</h6>
                                        </div>
                                        <div class="col-10 col-md-10 col-lg-10">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="leftMiddleImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                            </div>
                                            <h:inputHidden id="leftMiddle" value="#{loginBean.capturedMultiFinger.leftMiddle}"/>
                                            <h6 style="text-align:center; font-size: medium; font-weight: bold;">Left Middle</h6>
                                        </div>
                                        <div class="col-3 col-md-3 col-lg-3">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="leftRingImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                            </div>
                                            <h:inputHidden id="leftRing" value="#{loginBean.capturedMultiFinger.leftRing}"/>             
                                            <h6 style="text-align:center; font-size: medium; font-weight: bold;">Left Ring</h6>
                                        </div>
                                        <div class="col-3 col-md-3 col-lg-3">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="leftLittleImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                            </div>
                                            <h:inputHidden id="leftLittle" value="#{loginBean.capturedMultiFinger.leftLittle}"/>        
                                            <h6 style="text-align:center; font-size: medium; font-weight: bold;">Left Little</h6>
                                        </div>
                                    </div>
                                </div>

                                <div style="display: flex; flex-direction: row; margin-bottom: 30px; margin-top: 10px; align-content: center; justify-content: center;">
                                    <p:commandButton value="Capture Left Fingers" styleClass=" ui-button-secondary ui-button-raised" onclick="doSendNoId('action:start:leftFour');" type="button" style="font-size: medium; padding: 1px;"/>
                                </div>

                                <div style="display: flex; flex-direction: row; gap: 10px; justify-content: center; align-content: center;">
                                    <div class="col-3 col-md-3 col-lg-3">
                                        <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                            <h:graphicImage id="rightIndexImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                        </div>
                                        <h:inputHidden id="rightIndex" value="#{loginBean.capturedMultiFinger.rightIndex}"/>
                                        <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Index</h6>
                                    </div>
                                    <div class="col-3 col-md-3 col-lg-3">
                                        <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                            <h:graphicImage id="rightMiddleImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                        </div>
                                        <h:inputHidden id="rightMiddle" value="#{loginBean.capturedMultiFinger.rightMiddle}"/>
                                        <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Middle</h6>
                                    </div>
                                    <div class="col-3 col-md-3 col-lg-3">
                                        <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                            <h:graphicImage id="rightRingImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                        </div>
                                        <h:inputHidden id="rightRing" value="#{loginBean.capturedMultiFinger.rightRing}"/>
                                        <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Ring</h6>
                                    </div>
                                    <div class="col-3 col-md-3 col-lg-3">
                                        <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                            <h:graphicImage id="rightLittleImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                        </div>
                                        <h:inputHidden id="rightLittle" value="#{loginBean.capturedMultiFinger.rightLittle}"/>
                                        <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Little</h6>
                                    </div> 
                                </div>

                                <div style="display: flex; flex-direction: row; margin-bottom: 30px; margin-top: 10px; justify-content: center; align-content: center;">
                                    <p:commandButton value="Capture Right Fingers" styleClass=" ui-button-secondary ui-button-raised" onclick="doSendNoId('action:start:rightFour');" type="button" style="font-size: medium; padding: 1px;"/>
                                </div>

                                <div style="display: flex; flex-direction: row; gap: 10px; justify-content: center; align-content: center;">
                                    <div class="col-3 col-md-3 col-lg-3">
                                        <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                            <h:graphicImage id="rightThumbImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                        </div>
                                        <h:inputHidden id="rightThumb" value="#{loginBean.capturedMultiFinger.rightThumb}"/> <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Thumb</h6>
                                    </div>  
                                    <div class="col-3 col-md-3 col-lg-3">
                                        <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                            <h:graphicImage id="leftThumbImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                        </div>
                                        <h:inputHidden id="leftThumb" value="#{loginBean.capturedMultiFinger.leftThumb}"/> <h6 style="text-align:center; font-size: medium; font-weight: bold;">Left Thumb</h6>
                                    </div>
                                </div>

                                <div style="display: flex; flex-direction: row; margin-bottom: 30px; margin-top: 10px; justify-content: center; align-content: center;">
                                    <p:commandButton value="Capture Thumbs"  styleClass=" ui-button-secondary ui-button-raised" onclick="doSendNoId('action:start:twoThumbs');" type="button" style="font-size: medium; padding:1px; "/>
                                </div>

                                <p:commandButton value="LOGIN" action="#{loginBean.sendForVerification()}" update="growl passwordChangeForm" styleClass="verify-button" style="margin-left:auto; "/>

                            </div>
                        </div>
                    </div>
                </div>
            </h:form>
            
            
            <!-- Password Change Modal -->
            <h:form id="passwordChangeForm"  prependId="false">
                <div id="passwordChangeModal" class="password-modal-overlay" 
                     style="display: #{loginBean.showPasswordChangeModal ? 'flex' : 'none'};">
                    <div class="password-modal">
                        <div class="password-modal-header">
                            <i class="fas fa-lock"></i>
                            <h3>Password Change Required</h3>
                        </div>


                        <div class="password-modal-body">
                            <div class="security-notice">
                                <strong>Security Notice:</strong> You must change your temporary password before accessing the system.
                            </div>

                            <div class="password-form-group">
                                <p:outputLabel for="newPassword" value="New Password:" />
                                <p:password id="newPassword" 
                                            value="#{loginBean.newPassword}" 
                                            styleClass="password-input"
                                            required="true"
                                            placeholder="Enter your new password">

                                </p:password>
                            </div>

                            <div class="password-form-group">
                                <p:outputLabel for="confirmPassword" value="Confirm New Password:" />
                                <p:password id="confirmPassword" 
                                            value="#{loginBean.confirmPassword}" 
                                            styleClass="password-input"
                                            required="true"
                                            placeholder="Confirm your new password" />
                            </div>

                            <div class="password-requirements">
                                <h4>Password Requirements:</h4>
                                <ul>
                                    <li>At least 8 characters long</li>
                                    <li>Mix of letters and numbers recommended</li>
                                    <li>Avoid using personal information</li>
                                    <li>Choose something you can remember</li>
                                </ul>
                            </div>

                            <p:messages id="modalMessages" globalOnly="false" showDetail="true" showSummary="false" />
                        </div>

                        <div class="password-modal-footer">
                            <p:commandButton value="Change Password" 
                                             action="#{loginBean.changePassword}"
                                             styleClass="modal-btn btn-primary-modal"
                                             update="@form theForm"
                                             process="@form"
                                             />

                            <p:commandButton value="Cancel" 
                                             action="#{loginBean.cancelPasswordChange}"
                                             styleClass="modal-btn btn-secondary-modal"
                                             immediate="true"
                                             update="@form theForm"
                                             process="@this" />
                        </div>

                    </div>
                </div>
            </h:form>

            <!-- Auto-focus script for modal -->
            <h:outputScript library="js" name="subLogin.js"/>
            <h:outputScript rendered="#{sublogin.showPasswordChangeModal}">
                document.addEventListener('DOMContentLoaded', focusPasswordModal);
            </h:outputScript>
        </div>
    </h:body>
</html>
