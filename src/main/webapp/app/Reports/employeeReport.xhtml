<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<ui:composition template="/WEB-INF/template2.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="jakarta.faces.facelets">

    <ui:define name="metadata">
        <f:metadata>
            <f:viewAction action="#{empReportController.setupBreadcrumb}" />
        </f:metadata>
    </ui:define>

    <ui:define name="title">Employee Reports</ui:define>

    <ui:define name ="content">
        <!--Main Content --> 
        <div class="main-content">
            <p:growl id="messages" showSummary= "true" showDetail="true" life="3000" />


            <h:form id="employeeForm">
                <div style="display: flex; justify-content: space-between">
                    <div>
                        <h3>EMPLOYEE REPORT</h3>
                    </div>
                    <div style="margin-top: 10px">
                        <p:commandButton value="Export" 
                                         icon="pi pi-file-pdf" 
                                         styleClass="ui-button-secondary"
                                         action="#{empReportController.export()}"
                                         ajax="false"/>
                    </div>
                </div>
                <br/>
                <p:panel toggleable="true" header="Filters">

                    <p:panelGrid columns="4" styleClass="filter-grid" style="width: 100%;">
                        <p:outputPanel styleClass="filter-panel">
                            <p:outputLabel for="@next" value="Filter by Full Name" styleClass="filter-label"/>
                            <p:inputText value="#{empReportController.employeeName}"
                                         placeholder="Search by Name"
                                         styleClass="search-box"
                                         style="width: 100%; min-width: 200px;">
                            </p:inputText>
                        </p:outputPanel>

                        <p:outputPanel styleClass="filter-panel">
                            <p:outputLabel for="@next" value="Filter by National ID" styleClass="filter-label"/>
                            <p:inputText value="#{empReportController.ghanaCardNumber}"
                                         placeholder="Search by GhanaCard"
                                         styleClass="search-box"
                                         style="width: 100%; min-width: 200px;">
                            </p:inputText>
                        </p:outputPanel>

                        <p:outputPanel styleClass="filter-panel">
                            <p:outputLabel for="@next" value="Filter by Role" styleClass="filter-label"/>
                            <p:autoComplete value="#{empReportController.selectedRole}"
                                            completeMethod="#{empReportController.searchRoles}"
                                            var="role" itemLabel="#{role.roleName}" itemValue="#{role}"
                                            converter="employeeRoleConverter" 
                                            style="width: 90%; min-width: 200px;"
                                            inputStyle="width: 100%;"
                                            forceSelection="true" dropdown="true"
                                            placeholder="Search or Select Role" 
                                            panelStyle="max-height: 200px; overflow-y:auto;"/>
                        </p:outputPanel>

                        <p:outputPanel styleClass="filter-panel">
                            <p:outputLabel for="@next" value="Filter by Date Onboarded" styleClass="filter-label"/>
                            <p:datePicker selectionMode="range" 
                                          monthNavigator="true" 
                                          yearNavigator="true" 
                                          pattern="dd-MM-yyyy"
                                          showButtonBar="true" 
                                          value="#{empReportController.timeRange}"
                                          style="width: 100%; min-width: 200px;"
                                         />
                        </p:outputPanel>
                    </p:panelGrid>
                    <div style="display: flex; justify-content: space-between;">
                        <p:commandButton value="Reset" action="#{empReportController.reset()}" update="@form" 
                                         icon="fa-solid fa-spinner" iconPos="left" 
                                         styleClass="ui-button-raised ui-button-danger" style="margin-left: 1%"/>
                        <p:commandButton value="Generate Search Criteria" action="#{empReportController.fetchCriteria()}"
                                         icon="pi pi-search" iconPos="left" 
                                         update="@form" styleClass="ui-button-raised ui-button-success" style="margin-right: 1%"/>
                    </div>
                </p:panel>

                <p:spacer height="30px"/>


                <!-- Employee List -->
                <p:dataTable id="employeeTable" value="#{empReportController.employees}" var="employee"
                             paginator="true" paginatorPosition="bottom" rows="10"  rowIndexVar="rowIndex" rowStyleClass="#{rowIndex mod 2 eq 0 ? 'white-row' : 'ash-row'}">

                    <p:column headerText="Full Name" style="width: 200px;" >
                        <p:commandLink value="#{employee.firstname} #{employee.lastname}"
                                       action="#{empReportController.navigateToHistoryName(employee.fullName)}"
                                       style="color: black; font-weight: bold;" ajax="false" />    
                    </p:column>

                    <p:column headerText="National ID" style="width: 200px;">
                        <p:commandLink value="#{employee.ghanaCardNumber}"
                                       action="#{empReportController.navigateToHistory(employee.ghanaCardNumber)}"
                                       style="color: black" ajax="false" />   
                    </p:column>

                    <p:column headerText="Role" style="width: 200px;">
                        <h:outputText value="#{employee.role}"/>
                    </p:column>

                    <p:column headerText="Email" style="width: 300px;">
                        <h:outputText value="#{employee.email}" /> 
                    </p:column>

                    <p:column headerText="Date Onboarded" style="width: 200px;">
                        <h:outputText value="#{empReportController.formatEmpDate(employee)}" />
                    </p:column>

                    <p:column headerText="Accesible Entrances" style="width: 100px;">
                        <p:commandButton value="Entrances"  styleClass="ui-button-flat"
                                         action="#{empReportController.viewEntrances(employee)}"
                                         update=":employeeForm:entrancesDialog"
                                         oncomplete="PF('entrancesDialog').show()"/>
                    </p:column>
                </p:dataTable>


                <p:dialog id="entrancesDialog" widgetVar="entrancesDialog" modal="true" closable="false" class="custom-dialog">
                    <f:facet name="header">
                        <h:panelGroup layout="block" style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                            <h:outputText value="Accessible Entrances" style="font-weight: bold; font-size: 1.1rem;" />
                            <div>
                                <!-- Download icon button -->
                                <p:commandButton icon="pi pi-download" title="Download" action="#{empReportController.download()}" 
                                                 styleClass="rounded-button ui-button-flat p-button-sm" 
                                                 ajax="false"/>

                                <p:commandButton icon="pi pi-times" onclick="PF('entrancesDialog').hide()" styleClass="rounded-button ui-button-flat p-button-sm" style="color: black;" /> 
                            </div>
                        </h:panelGroup>
                    </f:facet>

                    <div class="same-line-container" style="margin-top: 1rem;">
                        <div>
                            <i class="pi pi-user p-mr-2 text-primary icon-style"></i>
                            <p:outputLabel value="Full Name: " styleClass="label-style" />
                            <h:outputText value="#{empReportController.selectedEmployee.fullName}" styleClass="value-style" />
                        </div>
                        <div>
                            <i class="pi pi-id-card p-mr-2 text-primary icon-style"></i>
                            <p:outputLabel value="National ID: " styleClass="label-style" />
                            <h:outputText value="#{empReportController.selectedEmployee.ghanaCardNumber}" styleClass="value-style" />
                        </div>
                    </div>

                    <div class="same-line-container" style="margin-top: 0.5rem;">
                        <div>
                            <i class="pi pi-calendar-plus p-mr-2 text-success icon-style"></i>
                            <p:outputLabel value="Date Onboarded: " styleClass="label-style" />
                            <h:outputText value="#{empReportController.selectedEmployee.createdAt}" styleClass="value-style" >
                                <f:convertDateTime pattern="d MMMM, yyyy hh:mm a" />
                            </h:outputText>
                        </div>
                        <div>
                            <i class="fa fa-user-tie p-mr-2 text-success icon-style"></i>
                            <p:outputLabel value="Role: " styleClass="label-style" />
                            <h:outputText value="#{empReportController.selectedEmployee.role.roleName}" styleClass="value-style" />
                        </div>
                    </div>

                    <p:separator style="margin-top: 1rem; margin-bottom: 1rem;" />

                    <!-- Default Entrances -->
                    <div style="margin-bottom: 1rem;">
                        <strong>• Default Entrances:</strong>
                        <br/><br/>

                        <ui:repeat value="#{empReportController.selectedEmployeeEntrances}" var="entrance">
                            <span class="skill-tag">• #{entrance.entranceName}</span>
                        </ui:repeat>
                    </div>
                    <br/>

                    <!-- Custom Entrances -->
                    <h:panelGroup rendered="#{!empty empReportController.selectedEmployeeCustomEntrances}">
                        <div>
                            <strong>• Custom Entrances:</strong>
                            <br/><br/>
                            <ui:repeat value="#{empReportController.selectedEmployeeCustomEntrances}" var="entrance">
                                <span class="skill-tag">• #{entrance.entranceName}</span>
                            </ui:repeat>
                        </div>
                    </h:panelGroup>
                </p:dialog>

            </h:form>
        </div>

        <style>
            .custom-dialog .ui-dialog-titlebar {
                background-color: #f4f4f4 !important;
                border-bottom: 1px solid #ccc;
            }
            .custom-dialog{
                width: 50% !important;
                overflow: hidden;
                height: 70%;
            }
            .label-style {
                font-size: 0.75rem;
                margin: 0;
                font-weight: bold;
            }
            .same-line-container {
                display: flex;
                justify-content: space-between;
                align-items: center; /* Vertically align items in the container */
                gap: 10px; /* Adjust the spacing between the elements as needed */
            }
            .icon-style {
                font-size: 1.2rem; /* Apply the font size to all icons */
                margin-right: 0.5rem; /* Add a little space to the right of each icon */
                color:#644d12;
            }
            .skill-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                opacity: 0;
                transform: translateY(10px);
                animation: fadeInUp 0.5s ease forwards;
            }
            .skill-tag {
                background-color: #e0f7fa;
                color: #006064;
                padding: 5px 10px;
                margin: 5px;
                border-radius: 20px;
                display: inline-block;
                font-size: 14px;
            }
            .white-row {
                background-color: white !important;
            }

            .ash-row {
                background-color: #f0f0f0 !important;
            }
            .white-row:hover, .ash-row:hover {
                background-color: #dceeff !important;
                cursor: pointer;
            }

            .ui-panelgrid .ui-panelgrid-cell {
                vertical-align: top;
                padding: 8px;
                white-space: nowrap;
            }

            .ui-datepicker-trigger {
                vertical-align: top;
            }

            /* Ensure consistent input heights */
            .ui-inputfield, .ui-autocomplete .ui-autocomplete-input {
                height: 2.5em;
                box-sizing: border-box;
            }
            .filter-grid {
                width: 100%;
                table-layout: fixed; /* This ensures equal column widths */
            }

            .filter-grid .ui-panelgrid-cell {
                vertical-align: top;
                padding: 10px 5px;
                width: 25%; /* Equal width for all 4 columns */
            }

            .filter-panel {
                display: flex;
                flex-direction: column;
                gap: 5px;
                width: 100%;
            }

        

            /* Ensure consistent input styling */
            .ui-inputfield,
            .ui-autocomplete-input,
            .ui-datepicker-input {
                height: 2.5em !important;
                padding: 0.5em !important;
                border: 1px solid #ccc !important;
                border-radius: 4px !important;
                box-sizing: border-box !important;
            }


            /* Fix datepicker alignment */
            .ui-datepicker-trigger {
                vertical-align: top !important;
                margin-left: 5px !important;
            }

            /* Responsive behavior */
            @media (max-width: 1200px) {
                .filter-grid {
                    table-layout: auto;
                }

                .filter-grid .ui-panelgrid-cell {
                    width: auto;
                    min-width: 250px;
                }
            }
        </style>
    </ui:define>
</ui:composition>

