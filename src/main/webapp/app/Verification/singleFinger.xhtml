<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<ui:composition template="/WEB-INF/template2.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="jakarta.faces.facelets">

    <ui:define name ="title">Update Employee Details</ui:define>
    <ui:define name ="head">
        <style type='text/css'>
            .ui-panelgrid {
                background: #f8fafc;
                border-radius: 8px;
                padding: 20px;
                width: 100%;
                max-width: 600px;
            }
            .ui-panelgrid .ui-panelgrid-cell {
                padding: 10px;
                font-size: 1rem;
            }
            .ui-panelgrid .ui-panelgrid-cell {
                font-size: 0.9rem;
            }
            .ui-button-success {
                background-color: #22c55e;
                border-color: #22c55e;
            }
            .ui-button-success:hover {
                background-color: #16a34a;
                transform: translateY(-2px);
            }



            .face-verification-panel {
                border: none !important;
                background: transparent !important;
            }

            .face-content-container {
                display: flex;
                flex-direction: column;
                width: 100%;
                max-width: 560px;
                margin: 0 auto;
            }

            .verification-heading {
                text-align: left;
                margin-bottom: 20px;
                font-weight: bold;
            }

            .input-group {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                margin-bottom: 20px;
            }

            .input-label {
                font-weight: bold;
                margin-bottom: 5px;
            }

            .id-input {
                width: 100%;
                padding: 8px;
                border-radius: 5px;
            }


        </style>
    </ui:define>

    <ui:define name ="content">
        <!--Main Content-->
        <div class="main-content">
            <h:form id="wizardForm" prependId="false">
                <p:growl widgetVar="fgrowl" id="growl" showDetail="true" showSummary="false" life="3000" />

                <ui:define name="metadata">
                    <f:metadata>
                        <f:viewAction action="#{singlefingerBean.setupBreadcrumb}" />
                    </f:metadata>
                </ui:define>

                <h1>Update Employee Details</h1>

                <p:steps activeIndex="#{singlefingerBean.currentStep}" >
                    <p:menuitem value="Select Verification Type"/>
                    <p:menuitem value="Perform Verification"/>
                    <p:menuitem value="Update Employee Details"/>
                </p:steps>

                <br/>
                <p:outputPanel id="stepContent">

                    <!-- Step 1: Select Verification Type -->
                    <p:panel rendered="#{singlefingerBean.currentStep == 0}">
                        <h3>Select Verification Type</h3>

                        <p:selectOneRadio id="verificationType" value="#{singlefingerBean.verificationType}" layout="pageDirection">
                            <f:selectItem itemLabel="Facial Verification" itemValue="Face"/>
                            <f:selectItem itemLabel="Single Finger" itemValue="Single Finger"/>
                            <f:selectItem itemLabel="Multi Finger" itemValue="Multi Finger"/>
                            <p:ajax update="wizardForm" />
                        </p:selectOneRadio>

                        <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                            <p:commandButton value="Next" action="#{singlefingerBean.nextStep}" update="wizardForm"
                                             disabled="#{empty singlefingerBean.verificationType}"
                                             style="background-color: green; color: white; padding: 1px 2px; font-weight: bold;"/>
                        </div>
                    </p:panel>

                    <!-- Step 2: Perform Verification -->

                    <p:panel rendered="#{singlefingerBean.currentStep == 1}" style="display: flex; justify-content: center; align-items: center; height:auto; border: none; margin-top: 20px;">
                        <div style="width: 600px;   padding: 20px; border: 2px solid black; border-radius: 10px; background-color: white;
                             box-shadow: 3px 3px 10px rgba(0,0,0,0.2); text-align: center;">

                            <h:inputText id="socketData" style="display: none;" value="#{singlefingerBean.socketData}" disabled="true"/>
                            <h:inputHidden id="socketDataHidden"/>

                            <!--  Multi finger Verification-->
                            <p:panel rendered="#{singlefingerBean.verificationType == 'Multi Finger'}"  style="border: none; ">


                                <div style="display: flex; flex-direction: row; gap: 20px;">

                                    <p:commandButton value="Reset" styleClass=" ui-button-warning ui-button-danger" onclick="doSendNoId('action:stop')" action="#{singlefingerBean.reset()}" update="@form"
                                                     style="margin-right: 20px;" />
                                </div>

                                <br/>

                                <div style="display: flex; flex-direction: column; width: 100%; justify-content: center; align-content: center;">

                                    <div class="card">
                                        <div style="display: flex; flex-direction: row; gap: 10px; justify-content: center; align-content: center; ">
                                            <div class="col-3 col-md-3 col-lg-3">
                                                <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                    <h:graphicImage id="leftIndexImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                                </div>
                                                <h:inputHidden id="leftIndex" value="#{singlefingerBean.capturedMultiFinger.leftIndex}"/>
                                                <h6 style="text-align:center; font-size: medium; font-weight: bold;" >Left Index</h6>
                                            </div>
                                            <div class="col-10 col-md-10 col-lg-10">
                                                <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                    <h:graphicImage id="leftMiddleImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                                </div>
                                                <h:inputHidden id="leftMiddle" value="#{singlefingerBean.capturedMultiFinger.leftMiddle}"/>
                                                <h6 style="text-align:center; font-size: medium; font-weight: bold;">Left Middle</h6>
                                            </div>
                                            <div class="col-3 col-md-3 col-lg-3">
                                                <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                    <h:graphicImage id="leftRingImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                                </div>
                                                <h:inputHidden id="leftRing" value="#{singlefingerBean.capturedMultiFinger.leftRing}"/>
                                                <h6 style="text-align:center; font-size: medium; font-weight: bold;">Left Ring</h6>
                                            </div>
                                            <div class="col-3 col-md-3 col-lg-3">
                                                <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                    <h:graphicImage id="leftLittleImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                                </div>
                                                <h:inputHidden id="leftLittle" value="#{singlefingerBean.capturedMultiFinger.leftLittle}"/>
                                                <h6 style="text-align:center; font-size: medium; font-weight: bold;">Left Little</h6>
                                            </div>
                                        </div>
                                    </div>

                                    <div style="display: flex; flex-direction: row; margin-bottom: 30px; margin-top: 10px; align-content: center; justify-content: center;">
                                        <p:commandButton value="Capture Left Fingers" styleClass=" ui-button-secondary ui-button-raised" onclick="doSendNoId('action:start:leftFour');" type="button" style="font-size: medium;"/>
                                    </div>

                                    <div style="display: flex; flex-direction: row; gap: 10px; justify-content: center; align-content: center;">
                                        <div class="col-3 col-md-3 col-lg-3">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="rightIndexImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                            </div>
                                            <h:inputHidden id="rightIndex" value="#{singlefingerBean.capturedMultiFinger.rightIndex}"/>
                                            <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Index</h6>
                                        </div>
                                        <div class="col-3 col-md-3 col-lg-3">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="rightMiddleImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                            </div>
                                            <h:inputHidden id="rightMiddle" value="#{singlefingerBean.capturedMultiFinger.rightMiddle}"/>
                                            <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Middle</h6>
                                        </div>
                                        <div class="col-3 col-md-3 col-lg-3">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="rightRingImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                            </div>
                                            <h:inputHidden id="rightRing" value="#{singlefingerBean.capturedMultiFinger.rightRing}"/>
                                            <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Ring</h6>
                                        </div>
                                        <div class="col-3 col-md-3 col-lg-3">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="rightLittleImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                            </div>
                                            <h:inputHidden id="rightLittle" value="#{singlefingerBean.capturedMultiFinger.rightLittle}"/>
                                            <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Little</h6>
                                        </div>
                                    </div>

                                    <div style="display: flex; flex-direction: row; margin-bottom: 30px; margin-top: 10px; justify-content: center; align-content: center;">
                                        <p:commandButton value="Capture Right Fingers" styleClass=" ui-button-secondary ui-button-raised" onclick="doSendNoId('action:start:rightFour');" type="button"/>
                                    </div>

                                    <div style="display: flex; flex-direction: row; gap: 10px; justify-content: center; align-content: center;">
                                        <div class="col-3 col-md-3 col-lg-3">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="rightThumbImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                            </div>
                                            <h:inputHidden id="rightThumb" value="#{singlefingerBean.capturedMultiFinger.rightThumb}"/> <h6 style="text-align:center; font-size: medium; font-weight: bold;">Right Thumb</h6>
                                        </div>
                                        <div class="col-3 col-md-3 col-lg-3">
                                            <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                                <h:graphicImage id="leftThumbImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                            </div>
                                            <h:inputHidden id="leftThumb" value="#{singlefingerBean.capturedMultiFinger.leftThumb}"/> <h6 style="text-align:center; font-size: medium; font-weight: bold;">Left Thumb</h6>
                                        </div>
                                    </div>

                                    <div style="display: flex; flex-direction: row; margin-bottom: 30px; margin-top: 10px;  ">
                                        <p:commandButton value="Capture Thumbs"  styleClass=" ui-button-secondary ui-button-raised" onclick="doSendNoId('action:start:twoThumbs');" type="button" style="font-size: medium;margin-left: 40%"/>

                                        <p:commandButton value="Submit" action="#{singlefingerBean.sendForVerification()}" update="growl" styleClass="ui-button-success" icon="pi pi-check" iconPos="right" style="margin-left:auto;"/>
                                    </div>
                                </div>
                            </p:panel>


                            <!-- Facial Verification -->
                            <p:panel rendered="#{singlefingerBean.verificationType == 'Face'}" styleClass="face-verification-panel">
                                <h:inputHidden id="faceImage" value="#{singlefingerBean.faceImageData}" />
                                <div class="face-content-container">
                                    <h3 class="verification-heading">Facial Verification</h3>

                                    <div class="input-group">
                                        <p:outputLabel for="faceNationalId" value="Enter GhanaCard Pin:" styleClass="input-label"/>
                                        <p:inputText id="faceNationalId" value="#{singlefingerBean.ghanaCardNumber}"
                                                     placeholder="GHA-XXXXXXXX-X" required="false"
                                                     requiredMessage="National ID is required for facial verification"
                                                     styleClass="id-input"/>
                                    </div>

                                    <div class="capture-container">
                                        <p:outputLabel value="Face Capture: *" styleClass="capture-label"/>
                                        <div id="faceImageContainer" class="face-capture-area"></div>
                                    </div>

                                    <div class="button-container">
                                        <div class="capture-buttons">
                                            <p:commandButton id="cameraButton" value="Open Camera"  type="button" icon="pi pi-camera" iconPos="left"
                                                             styleClass="ui-button-secondary capture-button" onclick="toggleCamera()" />

                                            <p:commandButton id="captureButton" value="Capture Face" onclick="capture();" type="button" 
                                                             styleClass="ui-button-secondary capture-button" style="display: none;"/>
                                        </div>
                                        <p:commandButton value="Submit Verification" onclick="saveCroppedImage()"
                                                         action="#{singlefingerBean.verifyFace()}" update="growl"
                                                         styleClass="ui-button-success verify-button"/>
                                    </div>
                                </div>
                            </p:panel>

                            <!-- Ghana Card Input -->
                            <p:panel header="Ghana Card and Single Finger Verification" 
                                     rendered="#{singlefingerBean.verificationType == 'Single Finger'}"
                                     style=" margin: auto; margin-top:10px; height:auto; color: blue; text-align: center;">

                                <!-- Ghana Card Input -->
                                <h:outputLabel for="ghanaCard" value="Enter Ghana Card Pin Number here" style="font-size: large; font-weight: bolder;"/>
                                <br/>
                                <p:inputText id="ghanaCardPin" value="#{singlefingerBean.ghanaCardNumber}"
                                             placeholder="GHA-XXXXXXXXX-X"/>

                                <br/><br/><br/>
                                <!-- Finger Selection -->
                                <h:outputLabel for="position" value="Select a Finger" style="font-size: large; font-weight: bolder;"/>
                                <br/>
                                <p:selectOneMenu id="position" value="#{singlefingerBean.fingerPosition}" widgetVar="position">
                                    <f:selectItem itemLabel="-- Select Finger --" itemValue="" noSelectionOption="true"/>
                                    <f:selectItem itemLabel="Left Thumb" itemValue="LT"/>
                                    <f:selectItem itemLabel="Left Index" itemValue="LI"/>
                                    <f:selectItem itemLabel="Left Middle" itemValue="LM"/>
                                    <f:selectItem itemLabel="Left Ring" itemValue="LR"/>
                                    <f:selectItem itemLabel="Left Little" itemValue="LL"/>
                                    <f:selectItem itemLabel="Right Thumb" itemValue="RT"/>
                                    <f:selectItem itemLabel="Right Index" itemValue="RI"/>
                                    <f:selectItem itemLabel="Right Middle" itemValue="RM"/>
                                    <f:selectItem itemLabel="Right Ring" itemValue="RR"/>
                                    <f:selectItem itemLabel="Right Little" itemValue="RL"/>
                                </p:selectOneMenu>

                                <br/><br/><br/>

                                <!-- Fingerprint Image Preview -->
                                <h:outputLabel value="Fingerprint Image" style="font-size: large; font-weight: bolder;"/>
                                <br/>

                                <div style="border: 2px solid black; padding: 5px; border-radius: 8px; display: inline-block;">
                                    <h:graphicImage id="fingerImage" value="/resources/images/fing.jpeg" width="99.9" height="100"/>
                                </div>

                                <h:inputHidden id="fingerData" value="#{singlefingerBean.capturedFinger}"/>
                                <br/><br/><br/>

                                <!-- Buttons -->
                                <div style="display:flex; flex-direction: row; gap: 5px; justify-content: space-between;">
                                    <p:commandButton value="Reset" style="margin-right: 10px;" styleClass=" ui-button-warning ui-button-danger" onclick="doSendNoId('action:stop')" action="#{singlefingerBean.reset}" update="@form" icon="pi pi-refresh"/>
                                    <p:commandButton value="Capture Finger" style="margin-right: 0px;" styleClass=" ui-button-secondary ui-button-raised" onclick="doSend('action:start:single');" type="button" icon="fa fa-thin fa-fingerprint fa-beat"/>
                                    <p:commandButton value="Submit" action="#{singlefingerBean.submit}"  update="growl" ajax="false"  styleClass="ui-button-success" icon="pi pi-check" iconPos="right" />
                                    <!--                                <h:inputText id="socketData" style="display: none;" value="#{singlefingerBean.socketData}" disabled="true"/>
                                    <h:inputHidden id="socketDataHidden"/>-->
                                </div>

                            </p:panel>
                            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                                <p:commandButton value="Back" action="#{singlefingerBean.prevStep}" update="wizardForm"/>

                            </div>
                        </div>
                    </p:panel>

                    <p:panel rendered="#{singlefingerBean.currentStep == 2}">
                        <h3 style="font-family: Roboto, sans-serif; font-size: 26px; font-weight: bold; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);"> Update Employee Details</h3>

                        <h:panelGroup layout="block" style="margin-bottom: 15px; text-align: center; width: 100%; display: block;" rendered="#{singlefingerBean.callBack.data != null}">
                            <h:outputLabel value="Name from Verification:"
                                           style="font-weight:bold; display:block; margin-bottom:5px; text-align: left;" />
                            <h:outputText value="#{singlefingerBean.callBack.data.person.forenames} #{singlefingerBean.callBack.data.person.surname}"
                                          style="display:block; font-style:italic; text-align: left;" />
                        </h:panelGroup>

                        <h:panelGroup layout="block" styleClass="form-container">
                            <!-- Left Column -->
                            <h:panelGroup styleClass="form-left">
                                <h:outputLabel value="National ID:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem; " />
                                <p:inputText value="#{singlefingerBean.foundEmployee.ghanaCardNumber}" disabled="true"
                                             styleClass="display-form"/>

                                <h:outputLabel value="Full Name:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{singlefingerBean.foundEmployee.fullName}" disabled="true"
                                             styleClass="display-form"/>

                                <h:outputLabel value="Forenames:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{singlefingerBean.foundEmployee.firstname}"  disabled="true"
                                             styleClass="display-form"/>

                                <h:outputLabel value="Surname:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{singlefingerBean.foundEmployee.lastname}" disabled="true"
                                             styleClass="display-form"/>

                                <h:outputLabel value="Date of Birth:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{singlefingerBean.foundEmployee.dateOfBirth}" disabled="true"
                                             styleClass="display-form"/>

                                <h:outputLabel value="Gender:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{singlefingerBean.foundEmployee.gender}" disabled="true"
                                              style="width:100%; padding:5px; margin-bottom:1rem;" />

                                <h:outputLabel value="Assigned Role:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{singlefingerBean.foundEmployee.role.roleName}"
                                             disabled="true"
                                              style="width:100%; padding:5px; margin-bottom:1rem;" />
                            </h:panelGroup>

                            <!-- Right Column -->
                            <h:panelGroup styleClass="form-right">
                                <h:outputLabel value="Address:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{singlefingerBean.updatedAddress}"  placeholder="Enter address"
                                             style="width:100%; padding:5px; margin-bottom:1rem;" />



                                <h:outputLabel value="Employment Status:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:selectOneMenu id="empStatus" value="#{singlefingerBean.updatedStatus}"
                                                 style="width:100%; margin-bottom:1rem;">
                                    <f:selectItem itemLabel="Select Employment Status" itemValue="" noSelectionOption="true" />
                                    <f:selectItems value="#{singlefingerBean.availableStatuses}" var="status"
                                                   itemLabel="#{status.empstatus}" itemValue="#{status.id}" />
                                </p:selectOneMenu>

                                <h:outputLabel value="Email Address:" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{singlefingerBean.updatedEmail}"  placeholder="Enter email address"
                                             style="width:100%; padding:5px; margin-bottom:1rem;" />

                                <h:outputLabel value="Primary Phone Number: *" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{wizardBean.primaryPhone}" placeholder="Enter primary phone number"
                                             style="width:100%; padding:5px; margin-bottom:1rem;" />

                                <h:outputLabel value="Secondary Phone Number" style="font-weight:bold; display:block; font-family: Roboto, sans-serif; color: #333; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); margin-bottom:0.5rem;" />
                                <p:inputText value="#{wizardBean.secondaryPhone}" placeholder="Optional"
                                             style="width:100%; padding:5px; margin-bottom:1rem;" />
                            </h:panelGroup>
                        </h:panelGroup>

                        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                            <p:commandButton value="Back" action="#{singlefingerBean.prevStep}" update="wizardForm"/>

                            <h:panelGroup rendered="#{singlefingerBean.showUpdateButton}">
                                <p:commandButton value="Update Employee Details"
                                                 action="#{singlefingerBean.updateEmployeeName}"
                                                 update="@form"
                                                 icon="pi pi-refresh"
                                                 styleClass="ui-button-success" />
                            </h:panelGroup>
                        </div>
                    </p:panel>
                </p:outputPanel>
            </h:form>
        </div>
        <h:outputScript library="js" name="webcam.js"/>
        <h:outputScript library="js" name="cropper.min.js"/>
        <h:outputScript library="js" name="facial.js"/>
        <h:outputScript library="js" name="orbis.js" target="head"/>
        <h:outputStylesheet library="css" name="cropper.min.css"/>
        <h:outputStylesheet library="css" name="onboardEmployee.css"/>

    </ui:define>
</ui:composition>